(function(){"use strict";var e={6199:function(e,t,o){var a=o(9199);const s={class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-baseline pt-3 pb-2 mb-3 border-bottom"},l=(0,a.createElementVNode)("h1",{class:"h2"},[(0,a.createTextVNode)(" Задачи: колонки "),(0,a.createElementVNode)("span",{class:"badge text-bg-warning"},"бета")],-1),n={class:"btn-toolbar mb-2 mb-md-0"},i=(0,a.createElementVNode)("i",{class:"fa-solid fa-columns"},null,-1),c=(0,a.createElementVNode)("i",{class:"fa-solid fa-table"},null,-1),r=(0,a.createElementVNode)("i",{class:"fa-solid fa-gears"},null,-1),d=(0,a.createElementVNode)("a",{class:"btn btn-sm btn-success",href:"/journal/task/create/"},[(0,a.createElementVNode)("i",{class:"fa-solid fa-file-circle-plus"}),(0,a.createTextVNode)(" Добавить задачу ")],-1),m={key:0,class:"d-flex align-items-center"},k=(0,a.createElementVNode)("div",{class:"spinner-border text-primary me-3",role:"status"},[(0,a.createElementVNode)("span",{class:"visually-hidden"},"Загрузка...")],-1),u=(0,a.createElementVNode)("div",null," Идёт загрузка — пожалуйста, подождите! ",-1),p=[k,u];function h(e,t,o,k,u,h){const f=(0,a.resolveComponent)("TaskListTable"),b=(0,a.resolveComponent)("TaskListSidebar");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[(0,a.createElementVNode)("div",s,[l,(0,a.createElementVNode)("div",n,[(0,a.createElementVNode)("button",{onClick:t[0]||(t[0]=e=>u.viewOptions.isTableView=!u.viewOptions.isTableView),class:"btn btn-sm btn-primary me-1"},[u.viewOptions.isTableView?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[i,(0,a.createTextVNode)(" Показать содержание задачи ")],64)):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[c,(0,a.createTextVNode)(" Скрыть содержание задачи ")],64))]),(0,a.createElementVNode)("button",{class:"btn btn-sm btn-primary me-2",onClick:t[1]||(t[1]=e=>u.viewOptions.showOptions=!u.viewOptions.showOptions)},[r,(0,a.createTextVNode)(" Настройки ")]),d])]),u.tasksAll.length&&u.categoriesAll.length&&u.userInfo.username?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[u.viewOptions.isTableView?((0,a.openBlock)(),(0,a.createBlock)(f,{key:0,tasks:u.tasksAll,"filtered-tasks":h.filteredTasks,categories:u.categoriesAll},null,8,["tasks","filtered-tasks","categories"])):((0,a.openBlock)(),(0,a.createBlock)(b,{key:1,"user-info":u.userInfo,tasks:u.tasksAll,"filtered-tasks":h.filteredTasks,categories:u.categoriesAll,"latest-notification":u.latestNotification,"is-web-socket-connected":u.isWebSocketConnected,onFavoriteToggled:h.fetchAllTasks,onAcquainted:h.fetchAllTasks},null,8,["user-info","tasks","filtered-tasks","categories","latest-notification","is-web-socket-connected","onFavoriteToggled","onAcquainted"]))],64)):((0,a.openBlock)(),(0,a.createElementBlock)("div",m,p))],64)}const f=e=>((0,a.pushScopeId)("data-v-3cc8d0d2"),e=e(),(0,a.popScopeId)(),e),b={class:"alert alert-secondary"},v={class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-baseline m-0"},N={class:"table-tasks-wrapper"},g={class:"table table-hover table-tasks text-nowrap"},V=f((()=>(0,a.createElementVNode)("th",{scope:"col",class:"text-center",style:{width:"30px"}},[(0,a.createElementVNode)("i",{class:"fa-regular fa-star"})],-1))),w=f((()=>(0,a.createElementVNode)("th",{scope:"col",class:"text-center",style:{width:"30px"}},[(0,a.createElementVNode)("i",{class:"fa-regular fa-lock"})],-1))),E=f((()=>(0,a.createElementVNode)("th",null," Задача ",-1))),C={key:0,class:"table-column-date text-center"},y={key:1,class:"table-column-date text-center"},T={class:"text-muted"},x={key:0,class:"fa-regular fa-lock"},B={key:0,class:"task-completed-mark"},S=f((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-check"},null,-1))),_=[S],I=["href"],O={key:1,class:"text-muted category-title"},A=f((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-comments"},null,-1))),F={key:0},D={key:2,class:"ms-1"},M=["href"],j=f((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-paperclip"},null,-1))),L=[j],q={key:3,class:"text-muted category-title"},P=f((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-tag"},null,-1))),U={key:0,class:"table-column-date text-center"},H={class:"text-muted category-title"},z={key:1,class:"table-column-date text-center"},R={class:"text-muted category-title"};function $(e,t,o,s,l,n){const i=(0,a.resolveComponent)("OptionsPanel"),c=(0,a.resolveComponent)("TaskFavoriteButton");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[(0,a.createElementVNode)("div",b,[(0,a.createElementVNode)("div",v,[(0,a.createElementVNode)("h4",null," Всего задач: "+(0,a.toDisplayString)(this.tasks.length)+", отображается: "+(0,a.toDisplayString)(o.filteredTasks.length)+". ",1)]),l.viewOptions.showOptions?((0,a.openBlock)(),(0,a.createBlock)(i,{key:0,categories:o.categories},null,8,["categories"])):(0,a.createCommentVNode)("",!0)]),(0,a.createElementVNode)("div",N,[(0,a.createElementVNode)("table",g,[(0,a.createElementVNode)("thead",null,[(0,a.createElementVNode)("tr",null,[V,w,E,l.viewOptions.showCreatedDate?((0,a.openBlock)(),(0,a.createElementBlock)("th",C," Создана ")):(0,a.createCommentVNode)("",!0),l.viewOptions.showCompletedDate?((0,a.openBlock)(),(0,a.createElementBlock)("th",y," Завершена ")):(0,a.createCommentVNode)("",!0)])]),(0,a.createElementVNode)("tbody",null,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(o.filteredTasks,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("tr",{key:e.id,class:(0,a.normalizeClass)(e.is_acquainted?"":"table-success")},[(0,a.createElementVNode)("td",null,[(0,a.createVNode)(c,{task:e,onToggled:t=>{e.is_favorite=t.is_favorite,this.$emit("favoriteToggled")}},null,8,["task","onToggled"])]),(0,a.createElementVNode)("td",T,[e.is_private?((0,a.openBlock)(),(0,a.createElementBlock)("i",x)):(0,a.createCommentVNode)("",!0)]),(0,a.createElementVNode)("td",null,[e.is_completed?((0,a.openBlock)(),(0,a.createElementBlock)("span",B,_)):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("a",{href:`/journal/task/${e.id}/`,class:"task-title-link"},(0,a.toDisplayString)(e.title),9,I),l.viewOptions.showCommentsCount?((0,a.openBlock)(),(0,a.createElementBlock)("span",O,[A,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.comments_count),1),e.new_comments_count?((0,a.openBlock)(),(0,a.createElementBlock)("span",F," · "+(0,a.toDisplayString)(e.new_comments_count),1)):(0,a.createCommentVNode)("",!0)])):(0,a.createCommentVNode)("",!0),e.attachment?((0,a.openBlock)(),(0,a.createElementBlock)("span",D,[(0,a.createElementVNode)("a",{href:e.attachment,class:"text-muted"},L,8,M)])):(0,a.createCommentVNode)("",!0),l.viewOptions.showCategory?((0,a.openBlock)(),(0,a.createElementBlock)("span",q,[P,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.category_title),1)])):(0,a.createCommentVNode)("",!0)]),l.viewOptions.showCreatedDate?((0,a.openBlock)(),(0,a.createElementBlock)("td",U,[(0,a.createElementVNode)("span",H,(0,a.toDisplayString)(n.useFormatDateTime(e.created)),1)])):(0,a.createCommentVNode)("",!0),l.viewOptions.showCompletedDate?((0,a.openBlock)(),(0,a.createElementBlock)("td",z,[(0,a.createElementVNode)("span",R,(0,a.toDisplayString)(e.is_completed?n.useFormatDateTime(e.completed):""),1)])):(0,a.createCommentVNode)("",!0)],2)))),128))])])])],64)}const J=e=>((0,a.pushScopeId)("data-v-31c385e6"),e=e(),(0,a.popScopeId)(),e),W={class:"row mb-3 border-top pt-3 mt-3"},Z={class:"col-6 col-lg-2"},Q=J((()=>(0,a.createElementVNode)("h5",{class:"options-title mb-1 pb-1 border-bottom"},"Фильтры",-1))),X=J((()=>(0,a.createElementVNode)("label",{for:"check-show-active",class:"options-checkbox-label"},"В работе",-1))),K=J((()=>(0,a.createElementVNode)("br",null,null,-1))),G=J((()=>(0,a.createElementVNode)("label",{for:"check-show-private",class:"options-checkbox-label"},"Личные",-1))),Y=J((()=>(0,a.createElementVNode)("br",null,null,-1))),ee=J((()=>(0,a.createElementVNode)("label",{for:"check-show-completed",class:"options-checkbox-label"},"Завершенные",-1))),te=J((()=>(0,a.createElementVNode)("br",null,null,-1))),oe=J((()=>(0,a.createElementVNode)("label",{for:"check-show-favorite-only",class:"options-checkbox-label"},[(0,a.createTextVNode)("Только "),(0,a.createElementVNode)("i",{class:"fa-regular fa-star"})],-1))),ae=J((()=>(0,a.createElementVNode)("br",null,null,-1))),se={class:"col-6 col-lg-2"},le=J((()=>(0,a.createElementVNode)("h5",{class:"options-title mb-1 pb-1 border-bottom"},"Упорядочить",-1))),ne={class:"col-6 col-lg-2"},ie=J((()=>(0,a.createElementVNode)("h5",{class:"options-title mb-1 pb-1 border-bottom"},"Отображение",-1))),ce={class:"options-checkbox-block"},re=J((()=>(0,a.createElementVNode)("label",{for:"check-auto-update",class:"options-checkbox-label"},"Автообновление",-1))),de={class:"options-checkbox-block"},me=J((()=>(0,a.createElementVNode)("label",{for:"check-show-category",class:"options-checkbox-label"},"Категории",-1))),ke={class:"options-checkbox-block"},ue=J((()=>(0,a.createElementVNode)("label",{for:"check-show-comments-count",class:"options-checkbox-label"},"Комментарии",-1))),pe={class:"options-checkbox-block"},he=J((()=>(0,a.createElementVNode)("label",{for:"check-show-created-date",class:"options-checkbox-label"},"Дата создания",-1))),fe={class:"options-checkbox-block"},be=J((()=>(0,a.createElementVNode)("label",{for:"check-show-completed-date",class:"options-checkbox-label"},"Дата завершения",-1))),ve={class:"col-6 col-lg-6"},Ne=J((()=>(0,a.createElementVNode)("h5",{class:"options-title mb-1 pb-1 border-bottom"},"Категории",-1))),ge=["id","value"],Ve=["for","onClick"],we=J((()=>(0,a.createElementVNode)("br",null,null,-1))),Ee=J((()=>(0,a.createElementVNode)("br",null,null,-1))),Ce={class:"btn-toolbar mb-0 justify-content-end border-top"},ye=J((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-close"},null,-1)));function Te(e,t,o,s,l,n){const i=(0,a.resolveComponent)("OrderBySelector");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[(0,a.createElementVNode)("div",W,[(0,a.createElementVNode)("div",Z,[Q,(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>l.taskFilters.showActive=e),id:"check-show-active"},null,512),[[a.vModelCheckbox,l.taskFilters.showActive]]),(0,a.createTextVNode)(),X,K,(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>l.taskFilters.showPrivate=e),id:"check-show-private"},null,512),[[a.vModelCheckbox,l.taskFilters.showPrivate]]),(0,a.createTextVNode)(),G,Y,(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>l.taskFilters.showCompleted=e),id:"check-show-completed"},null,512),[[a.vModelCheckbox,l.taskFilters.showCompleted]]),(0,a.createTextVNode)(),ee,te,(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>l.taskFilters.showFavoritesOnly=e),id:"check-show-favorite-only"},null,512),[[a.vModelCheckbox,l.taskFilters.showFavoritesOnly]]),(0,a.createTextVNode)(),oe,ae]),(0,a.createElementVNode)("div",se,[le,(0,a.createVNode)(i)]),(0,a.createElementVNode)("div",ne,[ie,(0,a.createElementVNode)("span",ce,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>l.fetchOptions.autoUpdate=e),id:"check-auto-update"},null,512),[[a.vModelCheckbox,l.fetchOptions.autoUpdate]]),(0,a.createTextVNode)(),re]),(0,a.createElementVNode)("span",de,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>l.viewOptions.showCategory=e),id:"check-show-category"},null,512),[[a.vModelCheckbox,l.viewOptions.showCategory]]),(0,a.createTextVNode)(),me]),(0,a.createElementVNode)("span",ke,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>l.viewOptions.showCommentsCount=e),id:"check-show-comments-count"},null,512),[[a.vModelCheckbox,l.viewOptions.showCommentsCount]]),(0,a.createTextVNode)(),ue]),(0,a.createElementVNode)("span",pe,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>l.viewOptions.showCreatedDate=e),id:"check-show-created-date"},null,512),[[a.vModelCheckbox,l.viewOptions.showCreatedDate]]),(0,a.createTextVNode)(),he]),(0,a.createElementVNode)("span",fe,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>l.viewOptions.showCompletedDate=e),id:"check-show-completed-date"},null,512),[[a.vModelCheckbox,l.viewOptions.showCompletedDate]]),(0,a.createTextVNode)(),be])]),(0,a.createElementVNode)("div",ve,[Ne,((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(this.categories,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("span",{key:e.id,class:"options-checkbox-block"},[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>l.viewOptions.categoriesVisibleIds=e),id:"category"+e.id,value:e.id},null,8,ge),[[a.vModelCheckbox,l.viewOptions.categoriesVisibleIds]]),(0,a.createTextVNode)(),(0,a.createElementVNode)("label",{for:"category"+e.id,class:"options-checkbox-label",onClick:(0,a.withModifiers)((t=>l.viewOptions.categoriesVisibleIds=[e.id]),["alt","prevent"])},(0,a.toDisplayString)(e.title),9,Ve),we])))),128)),(0,a.createElementVNode)("button",{onClick:t[10]||(t[10]=e=>l.viewOptions.categoriesVisibleIds=[]),class:"btn btn-sm btn-primary me-1 mt-2"},"Убрать все"),(0,a.createElementVNode)("button",{onClick:t[11]||(t[11]=e=>l.viewOptions.copyAllCategoryIdsToVisible(o.categories)),class:"btn btn-sm btn-primary mt-2"},"Показать все"),Ee])]),(0,a.createElementVNode)("div",Ce,[(0,a.createElementVNode)("button",{class:"btn btn-sm btn-primary me-2 mb-0 mt-2",onClick:t[12]||(t[12]=e=>l.viewOptions.showOptions=!l.viewOptions.showOptions)},[ye,(0,a.createTextVNode)(" Закрыть настройки ")])])],64)}const xe=e=>((0,a.pushScopeId)("data-v-4460c7de"),e=e(),(0,a.popScopeId)(),e),Be=xe((()=>(0,a.createElementVNode)("h6",{class:"options-title"},"Сортировать по:",-1))),Se={class:"drop-item"},_e=["onClick"],Ie=xe((()=>(0,a.createElementVNode)("h6",{class:"options-title"},"Доступные поля:",-1))),Oe={class:"drop-item"};function Ae(e,t,o,s,l,n){const i=(0,a.resolveComponent)("draggable");return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.createElementVNode)("div",null,[Be,(0,a.createVNode)(i,{list:l.fieldsSelected,itemKey:"id",group:"fields",class:"drop-area"},{item:(0,a.withCtx)((({element:e})=>[(0,a.createElementVNode)("div",Se,[(0,a.createTextVNode)((0,a.toDisplayString)(e.name)+" ",1),(0,a.createElementVNode)("button",{class:"button-ascending",onClick:t=>e.ascending=!e.ascending},(0,a.toDisplayString)(e.ascending?"▲":"▼"),9,_e)])])),_:1},8,["list"])]),(0,a.createElementVNode)("div",null,[Ie,(0,a.createVNode)(i,{list:l.fieldsAvailable,itemKey:"id",group:"fields",class:"drop-area"},{item:(0,a.withCtx)((({element:e})=>[(0,a.createElementVNode)("div",Oe,(0,a.toDisplayString)(e.name),1)])),_:1},8,["list"])])])}o(7658);var Fe=o(6983),De=o.n(Fe);const Me=(0,a.reactive)({autoUpdate:!0,pollDataTimeout:12e3,orderByFields:[],set(e){this.autoUpdate=e.autoUpdate,this.pollDataTimeout=e.pollDataTimeout,this.orderByFields=e.orderByFields}});var je={components:{draggable:De()},props:{},data(){return{fetchOptions:Me,fieldsSelected:[{name:"Новое",id:1,sortField:"is_acquainted",ascending:!0},{name:"Избранное",id:2,sortField:"is_favorite",ascending:!1},{name:"В работе",id:3,sortField:"is_completed",ascending:!0},{name:"Завершено",id:4,sortField:"completed",ascending:!1}],fieldsAvailable:[{name:"Создано",id:5,sortField:"created",ascending:!0},{name:"Личное",id:6,sortField:"is_private",ascending:!0}]}},watch:{fieldsSelected:{handler(e){localStorage.setItem("fieldsSelected",JSON.stringify(e)),Me.orderByFields=this.orderByFields},deep:!0},fieldsAvailable:{handler(e){localStorage.setItem("fieldsAvailable",JSON.stringify(e))},deep:!0}},computed:{orderByFields(){let e=[];return this.fieldsSelected.forEach((t=>{e.push(t.ascending?t.sortField:"-"+t.sortField)})),e}},mounted(){let e=JSON.parse(localStorage.getItem("fieldsSelected"));e&&(this.fieldsSelected=e);let t=JSON.parse(localStorage.getItem("fieldsAvailable"));t&&(this.fieldsAvailable=t)}},Le=o(89);const qe=(0,Le.Z)(je,[["render",Ae],["__scopeId","data-v-4460c7de"]]);var Pe=qe;const Ue=(0,a.reactive)({showActive:!0,showCompleted:!1,showPrivate:!0,showFavoritesOnly:!1,set(e){this.showActive=e.showActive,this.showCompleted=e.showCompleted,this.showPrivate=e.showPrivate,this.showFavoritesOnly=e.showFavoritesOnly}}),He=(0,a.reactive)({isTableView:!1,showOptions:!0,showCategory:!1,showCommentsCount:!0,showCreatedDate:!1,showCompletedDate:!1,categoriesVisibleIds:null,set(e){this.isTableView=e.isTableView,this.showOptions=e.showOptions,this.showCategory=e.showCategory,this.showCommentsCount=e.showCommentsCount,this.showCreatedDate=e.showCreatedDate,this.showCompletedDate=e.showCompletedDate,this.categoriesVisibleIds=e.categoriesVisibleIds},copyAllCategoryIdsToVisible(e){this.categoriesVisibleIds=[];for(let t=0;t<e.length;t++)this.categoriesVisibleIds.push(e[t].id)}});var ze={name:"OptionsPanel",components:{OrderBySelector:Pe},props:{categories:Array},data(){return{fetchOptions:Me,taskFilters:Ue,viewOptions:He}}};const Re=(0,Le.Z)(ze,[["render",Te],["__scopeId","data-v-31c385e6"]]);var $e=Re;const Je=e=>((0,a.pushScopeId)("data-v-5a7e42b6"),e=e(),(0,a.popScopeId)(),e),We=Je((()=>(0,a.createElementVNode)("i",{class:"fa-regular fa-star"},null,-1))),Ze=[We];function Qe(e,t,o,s,l,n){return(0,a.openBlock)(),(0,a.createElementBlock)("button",{class:(0,a.normalizeClass)(["favorite-button",o.task.is_favorite?"is-favorite":""]),onClick:t[0]||(t[0]=(0,a.withModifiers)((e=>n.onClick(o.task)),["stop"]))},Ze,2)}var Xe={name:"TaskFavoriteButton",props:{task:Object},emits:["toggled"],data(){return{isFetching:!1}},methods:{onClick(e){const t=`/journal/tasks/api/v1/task/${e.id}/favorite/`;if(!this.isFetching)return this.isFetching=!0,window.axios.get(t,{params:{}}).then((e=>(this.$emit("toggled",e.data),e.data))).catch((function(e){throw console.error("Axios.get error:",e),e})).finally((()=>{this.isFetching=!1}))}}};const Ke=(0,Le.Z)(Xe,[["render",Qe],["__scopeId","data-v-5a7e42b6"]]);var Ge=Ke;function Ye(e){let t=new Date(e);return t.toLocaleDateString("ru-RU")+" "+t.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}function et(e){return e.author_avatar_url?"/media/"+e.author_avatar_url:"/static/images/default_profile_pic.png"}function tt(e){return`${e.author_last_name} ${e.author_first_name.slice(0,1)}.${e.author_second_name.slice(0,1)}.`}function ot(e){return"string"==typeof e?e.split(/\r\n|\r|\n/).length:0}var at={name:"TaskListTable",components:{OptionsPanel:$e,TaskFavoriteButton:Ge},props:{tasks:Array,filteredTasks:Array,categories:Array},emits:["favoriteToggled"],data(){return{viewOptions:He}},methods:{useFormatDateTime:Ye}};const st=(0,Le.Z)(at,[["render",$],["__scopeId","data-v-3cc8d0d2"]]);var lt=st;const nt=e=>((0,a.pushScopeId)("data-v-959d1fe8"),e=e(),(0,a.popScopeId)(),e),it={class:"component"},ct={class:"tasks"},rt={class:"d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none border-bottom"},dt={class:"d-flex flex-grow-1"},mt={class:"tasks-task-counts flex-grow-1"},kt=nt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-display"},null,-1))),ut=nt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-eye-slash"},null,-1))),pt=nt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-star"},null,-1))),ht=nt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-bars-progress"},null,-1))),ft=nt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-tasks"},null,-1))),bt={key:0,class:"fa-solid fa-plug-circle-check",style:{color:"var(--bs-success)"}},vt={key:1,class:"fa-solid fa-plug-circle-minus",style:{color:"var(--bs-danger)"}},Nt={class:"task-list list-group list-group-flush"},gt=["onClick"],Vt={class:"d-flex w-100 align-items-center justify-content-between"},wt={key:0,class:"task-completed-mark"},Et=nt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-check"},null,-1))),Ct=[Et],yt={key:0,class:"text-muted"},Tt=nt((()=>(0,a.createElementVNode)("i",{class:"fa-regular fa-lock"},null,-1))),xt=[Tt],Bt={class:"task-list-item-info mb-1 small"},St={key:0,class:"task-list-item-info-comment-count"},_t=nt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-comments"},null,-1))),It=nt((()=>(0,a.createElementVNode)("i",{class:"fa-regular fa-tag"},null,-1))),Ot={key:0,class:"alert alert-secondary flex-grow-1 m-1"},At={key:1,class:"task-detail"},Ft={key:0},Dt={key:1,class:"alert alert-success"},Mt=nt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-file-circle-check"},null,-1))),jt={key:2,class:"btn-toolbar mb-2 mb-md-0 justify-content-end"},Lt=nt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-file-signature"},null,-1)));function qt(e,t,o,s,l,n){const i=(0,a.resolveComponent)("TaskFavoriteButton"),c=(0,a.resolveComponent)("OptionsPanel"),r=(0,a.resolveComponent)("TaskCard"),d=(0,a.resolveComponent)("CommentTimelineItem"),m=(0,a.resolveComponent)("TimeLine"),k=(0,a.resolveComponent)("NewCommentEditor");return(0,a.openBlock)(),(0,a.createElementBlock)("div",it,[(0,a.createElementVNode)("div",ct,[(0,a.createElementVNode)("div",rt,[(0,a.createElementVNode)("div",dt,[(0,a.createElementVNode)("div",mt,[kt,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(o.filteredTasks.length)+" | ",1),ut,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(n.newTasksCount)+" | ",1),pt,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(n.favoriteTasksCount)+" | ",1),ht,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(n.activeTasksCount)+" | ",1),ft,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(o.tasks.length)+" ",1)]),(0,a.createElementVNode)("div",null,[o.isWebSocketConnected?((0,a.openBlock)(),(0,a.createElementBlock)("i",bt)):((0,a.openBlock)(),(0,a.createElementBlock)("i",vt))])])]),(0,a.createElementVNode)("div",Nt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(this.filteredTasks,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("a",{key:e.id,href:"#",onClick:t=>this.selectedItem=e,class:(0,a.normalizeClass)(["task-list-item list-group-item list-group-item-action py-3 lh-sm",{active:n.isTaskListItemActive(e),"bg-success-subtle":n.isTaskListItemBgSuccessClass(e)}])},[(0,a.createElementVNode)("div",Vt,[(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)(["task-list-item-title flex-grow-1",e.is_acquainted?"":"task-list-item-title-new"])},[e.is_completed?((0,a.openBlock)(),(0,a.createElementBlock)("span",wt,Ct)):(0,a.createCommentVNode)("",!0),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(n.sanitize(e.title)),1)],2),(0,a.createVNode)(i,{task:e,onToggled:t=>{e.is_favorite=t.is_favorite,l.detailItem&&l.detailItem.id===e.id&&(l.detailItem.is_favorite=t.is_favorite),this.$emit("favoriteToggled")}},null,8,["task","onToggled"]),e.is_private?((0,a.openBlock)(),(0,a.createElementBlock)("span",yt,xt)):(0,a.createCommentVNode)("",!0)]),(0,a.createElementVNode)("div",Bt,[l.viewOptions.showCommentsCount?((0,a.openBlock)(),(0,a.createElementBlock)("span",St,[_t,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.comments_count),1),e.new_comments_count?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[(0,a.createTextVNode)(" · "+(0,a.toDisplayString)(e.new_comments_count),1)],64)):(0,a.createCommentVNode)("",!0)])):(0,a.createCommentVNode)("",!0),l.viewOptions.showCategory?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[It,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.category_title),1)],64)):(0,a.createCommentVNode)("",!0)])],10,gt)))),128))])]),l.viewOptions.showOptions?((0,a.openBlock)(),(0,a.createElementBlock)("div",Ot,[(0,a.createVNode)(c,{categories:o.categories},null,8,["categories"])])):((0,a.openBlock)(),(0,a.createElementBlock)("div",At,[l.selectedItem?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[l.detailItem?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[(0,a.createElementVNode)("h3",null,(0,a.toDisplayString)(n.sanitize(l.detailItem.title)),1),(0,a.createVNode)(r,{task:l.detailItem,"user-info":o.userInfo,onFavoriteToggled:t[0]||(t[0]=e=>{l.detailItem.is_favorite=e.is_favorite,this.$emit("favoriteToggled")})},null,8,["task","user-info"]),l.comments?((0,a.openBlock)(),(0,a.createBlock)(m,{key:0},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(l.comments,(e=>((0,a.openBlock)(),(0,a.createBlock)(d,{key:e.id,comment:e,"user-info":o.userInfo},null,8,["comment","user-info"])))),128))])),_:1})):(0,a.createCommentVNode)("",!0),l.detailItem.is_completed?((0,a.openBlock)(),(0,a.createElementBlock)("div",Dt,[Mt,(0,a.createTextVNode)(" Задача завершена. ")])):(0,a.createCommentVNode)("",!0),!l.detailItem.is_acquainted&&l.detailItem.is_completed?((0,a.openBlock)(),(0,a.createElementBlock)("div",jt,[(0,a.createElementVNode)("button",{onClick:t[1]||(t[1]=(0,a.withModifiers)(((...e)=>n.onClickAcquaint&&n.onClickAcquaint(...e)),["prevent"])),class:"btn btn-sm btn-primary me-2 mb-3"},[Lt,(0,a.createTextVNode)(" Ознакомлен ")])])):(0,a.createCommentVNode)("",!0),l.detailItem.is_completed?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createBlock)(k,{key:3,onNewCommentPosted:n.onNewCommentPosted,task:l.detailItem,"user-info":o.userInfo,"on-click-acquaint":n.onClickAcquaint},null,8,["onNewCommentPosted","task","user-info","on-click-acquaint"]))],64)):(0,a.createCommentVNode)("",!0)],64)):((0,a.openBlock)(),(0,a.createElementBlock)("span",Ft," Выберите задачу слева "))]))])}const Pt=e=>((0,a.pushScopeId)("data-v-3b0638ea"),e=e(),(0,a.popScopeId)(),e),Ut={class:"card-header text-muted"},Ht={class:"d-flex flex-wrap flex-md-nowrap align-items-center"},zt={class:"flex-grow-1"},Rt={key:0,class:"fa-solid fa-lock me-1"},$t=Pt((()=>(0,a.createElementVNode)("i",{class:"fa-regular fa-calendar"},null,-1))),Jt=Pt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-user"},null,-1))),Wt=Pt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-calendar-check"},null,-1))),Zt=["href"],Qt=Pt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-arrow-up-right-from-square"},null,-1))),Xt=[Qt],Kt={key:0},Gt=Pt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-pen-to-square"},null,-1))),Yt=[Gt],eo={key:0,class:"nav nav-tabs ms-1 mt-1"},to={class:"nav-item"},oo={class:"nav-item"},ao={key:1,class:"d-flex mb-3 flex-wrap ms-1 me-1"},so=["rows"],lo={key:1,class:"card-body d-block w-100"},no=["innerHTML"],io=Pt((()=>(0,a.createElementVNode)("div",{class:"help-text flex-grow-1 text-muted p-1 align-items-center"},[(0,a.createElementVNode)("i",{class:"fa-solid fa-info-circle"}),(0,a.createTextVNode)(" В тексте задачи можно использовать разметку "),(0,a.createElementVNode)("a",{href:"http://konvut.github.io/k50articles/",target:"_blank"},[(0,a.createTextVNode)("Markdown "),(0,a.createElementVNode)("i",{class:"fa-solid fa-question-circle"})]),(0,a.createTextVNode)(" . ")],-1))),co={class:"btn-toolbar mt-1 mb-2 mb-md-0 justify-content-end"},ro=Pt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-cancel"},null,-1))),mo=Pt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-save"},null,-1))),ko={key:2,class:"card-body task-card-body"},uo=["innerHTML"],po={key:0,class:"mt-3"},ho=Pt((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-paperclip"},null,-1))),fo=["href"];function bo(e,t,o,s,l,n){const i=(0,a.resolveComponent)("TaskFavoriteButton");return(0,a.openBlock)(),(0,a.createElementBlock)("div",{class:(0,a.normalizeClass)(["card mb-2",o.task.is_acquainted?"":"card-new border-success"])},[(0,a.createElementVNode)("div",Ut,[(0,a.createElementVNode)("div",Ht,[(0,a.createElementVNode)("div",zt,[(0,a.createVNode)(i,{task:o.task,onToggled:t[0]||(t[0]=e=>{this.$emit("favoriteToggled",e)}),style:{margin:"0 5px 0 0"}},null,8,["task"]),o.task.is_private?((0,a.openBlock)(),(0,a.createElementBlock)("i",Rt)):(0,a.createCommentVNode)("",!0),$t,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(n.useFormatDateTime(o.task.created))+" · ",1),Jt,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(n.useAuthorShortName(o.task))+" ",1),o.task.is_completed?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createTextVNode)(" · "),Wt,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(n.useFormatDateTime(o.task.completed)),1)],64)):(0,a.createCommentVNode)("",!0),(0,a.createTextVNode)(" · "),(0,a.createElementVNode)("a",{class:"text-muted",href:`/journal/task/${o.task.id}/`,target:"_blank"},Xt,8,Zt)]),l.isEditing?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createElementBlock)("div",Kt,[o.task.author===o.userInfo.id?((0,a.openBlock)(),(0,a.createElementBlock)("a",{key:0,onClick:t[1]||(t[1]=(0,a.withModifiers)(((...e)=>n.onClickEdit&&n.onClickEdit(...e)),["prevent"])),class:"toolbar-link toolbar-link-primary me-1"},Yt)):(0,a.createCommentVNode)("",!0)]))])]),l.isEditing?((0,a.openBlock)(),(0,a.createElementBlock)("ul",eo,[(0,a.createElementVNode)("li",to,[(0,a.createElementVNode)("a",{class:(0,a.normalizeClass)(["nav-link","edit"===l.activeEditorTabName?"active":""]),onClick:t[2]||(t[2]=(0,a.withModifiers)((e=>l.activeEditorTabName="edit"),["prevent"])),href:"#"},"Редактировать",2)]),(0,a.createElementVNode)("li",oo,[(0,a.createElementVNode)("a",{class:(0,a.normalizeClass)(["nav-link","preview"===l.activeEditorTabName?"active":""]),onClick:t[3]||(t[3]=(0,a.withModifiers)((e=>l.activeEditorTabName="preview"),["prevent"])),href:"#"},"Предпросмотр",2)])])):(0,a.createCommentVNode)("",!0),l.isEditing?((0,a.openBlock)(),(0,a.createElementBlock)("div",ao,["edit"===l.activeEditorTabName?(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createElementBlock)("textarea",{key:0,class:"form-control","onUpdate:modelValue":t[4]||(t[4]=e=>l.modifiedBody=e),rows:n.textAreaRowsQty},"\n      ",8,so)),[[a.vModelText,l.modifiedBody]]):(0,a.createCommentVNode)("",!0),"preview"===l.activeEditorTabName?((0,a.openBlock)(),(0,a.createElementBlock)("div",lo,[(0,a.createElementVNode)("span",{innerHTML:n.markdownToHtml(this.modifiedBody)},null,8,no)])):(0,a.createCommentVNode)("",!0),io,(0,a.createElementVNode)("div",co,[(0,a.createElementVNode)("button",{class:"btn btn-sm btn-secondary me-1",onClick:t[5]||(t[5]=e=>l.isEditing=!1)},[ro,(0,a.createTextVNode)(" Отмена ")]),(0,a.createElementVNode)("button",{class:"btn btn-sm btn-success",onClick:t[6]||(t[6]=(...e)=>n.onClickSave&&n.onClickSave(...e))},[mo,(0,a.createTextVNode)(" Сохранить ")])])])):(0,a.createCommentVNode)("",!0),l.isEditing?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createElementBlock)("div",ko,[(0,a.createElementVNode)("span",{innerHTML:n.markdownToHtml(o.task.body)},null,8,uo),o.task.attachment?((0,a.openBlock)(),(0,a.createElementBlock)("p",po,[ho,(0,a.createTextVNode)(" Файл: "),(0,a.createElementVNode)("a",{href:o.task.attachment},(0,a.toDisplayString)(decodeURI(o.task.attachment)),9,fo)])):(0,a.createCommentVNode)("",!0)]))],2)}var vo={name:"TaskCard",components:{TaskFavoriteButton:Ge},props:{task:Object,userInfo:Object},emits:["favoriteToggled"],data(){return{isEditing:!1,activeEditorTabName:"edit",modifiedBody:null}},computed:{textAreaRowsQty(){const e=3,t=ot(this.modifiedBody);return t<=e?e:t}},methods:{useFormatDateTime:Ye,useAuthorAvatarURL:et,useAuthorShortName:tt,useLinesCount:ot,onClickEdit(){this.isEditing=!0,this.activeEditorTabName="edit",this.modifiedBody=this.task.body},onClickSave(){alert("В РАЗРАБОТКЕ!\nЗдесь редактирование пока не работает - воспользуйтесь кнопкой редактирования задачи на отдельной странице задачи.\n\nEdit task "+this.task.id)},markdownToHtml(e){return this.markdown(e)}}};const No=(0,Le.Z)(vo,[["render",bo],["__scopeId","data-v-3b0638ea"]]);var go=No;const Vo={class:"timeline"},wo=(0,a.createElementVNode)("div",{class:"timeline__line"},null,-1),Eo={class:"timeline__items"};function Co(e,t,o,s,l,n){return(0,a.openBlock)(),(0,a.createElementBlock)("div",Vo,[wo,(0,a.createElementVNode)("div",Eo,[(0,a.renderSlot)(e.$slots,"default")])])}var yo={name:"TimeLine"};const To=(0,Le.Z)(yo,[["render",Co]]);var xo=To;const Bo={class:"timeline__item mb-3"},So={class:"timeline__top mb-2"},_o=(0,a.createElementVNode)("div",{class:"timeline__circle text-center"},[(0,a.createElementVNode)("i",{class:"fa-solid fa-comment"})],-1),Io=["id"],Oo={class:"timeline__desc_avatar"},Ao={class:"d-flex"},Fo={class:"timeline__desc_avatar__avatar mt-3 me-2"},Do=["src","alt"];function Mo(e,t,o,s,l,n){const i=(0,a.resolveComponent)("CommentCard");return(0,a.openBlock)(),(0,a.createElementBlock)("div",Bo,[(0,a.createElementVNode)("div",So,[_o,(0,a.createElementVNode)("div",{class:"timeline__title",id:"comment-"+o.comment.id}," Добавлен комментарий: ",8,Io)]),(0,a.createElementVNode)("div",Oo,[(0,a.createElementVNode)("div",Ao,[(0,a.createElementVNode)("div",Fo,[(0,a.createElementVNode)("img",{class:"rounded-circle",src:n.useAuthorAvatarURL(o.comment),alt:"Фото "+n.useAuthorShortName(o.comment),width:"48",height:"48"},null,8,Do)]),(0,a.createVNode)(i,{comment:o.comment,"user-info":o.userInfo},null,8,["comment","user-info"])])])])}const jo=e=>((0,a.pushScopeId)("data-v-2ce3f3ca"),e=e(),(0,a.popScopeId)(),e),Lo={class:"card-header d-flex text-muted"},qo={class:"flex-grow-1"},Po=jo((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-user"},null,-1))),Uo={key:0},Ho=jo((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-pen-to-square"},null,-1))),zo=[Ho],Ro=jo((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-trash"},null,-1))),$o=[Ro],Jo={key:0,class:"nav nav-tabs ms-1 mt-1"},Wo={class:"nav-item"},Zo={class:"nav-item"},Qo={key:1,class:"d-flex mb-3 flex-wrap ms-1 me-1"},Xo=["rows"],Ko={key:1,class:"card-body d-block w-100"},Go=["innerHTML"],Yo=jo((()=>(0,a.createElementVNode)("div",{class:"help-text flex-grow-1 text-muted p-1 align-items-center"},[(0,a.createElementVNode)("i",{class:"fa-solid fa-info-circle"}),(0,a.createTextVNode)(" В тексте задачи можно использовать разметку "),(0,a.createElementVNode)("a",{href:"http://konvut.github.io/k50articles/",target:"_blank"},[(0,a.createTextVNode)("Markdown "),(0,a.createElementVNode)("i",{class:"fa-solid fa-question-circle"})]),(0,a.createTextVNode)(" . ")],-1))),ea={class:"btn-toolbar mt-1 mb-2 mb-md-0 justify-content-end"},ta=jo((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-cancel"},null,-1))),oa=jo((()=>(0,a.createElementVNode)("i",{class:"fa-solid fa-save"},null,-1))),aa=["id"],sa=["innerHTML"];function la(e,t,o,s,l,n){return(0,a.openBlock)(),(0,a.createElementBlock)("div",{class:(0,a.normalizeClass)(["card flex-grow-1",o.comment.is_acquainted?"bubble":"card-new border-success bubble-new"])},[(0,a.createElementVNode)("div",Lo,[(0,a.createElementVNode)("div",qo,[Po,(0,a.createTextVNode)(" "+(0,a.toDisplayString)(n.useAuthorShortName(o.comment))+", "+(0,a.toDisplayString)(n.useFormatDateTime(o.comment.created)),1)]),l.isEditing?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createElementBlock)("div",Uo,[o.comment.author===o.userInfo.id?((0,a.openBlock)(),(0,a.createElementBlock)("a",{key:0,class:"toolbar-link toolbar-link-primary me-1",onClick:t[0]||(t[0]=(0,a.withModifiers)(((...e)=>n.onClickEdit&&n.onClickEdit(...e)),["prevent"]))},zo)):(0,a.createCommentVNode)("",!0),o.comment.author===o.userInfo.id?((0,a.openBlock)(),(0,a.createElementBlock)("a",{key:1,class:"toolbar-link toolbar-link-danger",onClick:t[1]||(t[1]=(0,a.withModifiers)(((...e)=>n.onClickArchive&&n.onClickArchive(...e)),["prevent"]))},$o)):(0,a.createCommentVNode)("",!0)]))]),l.isEditing?((0,a.openBlock)(),(0,a.createElementBlock)("ul",Jo,[(0,a.createElementVNode)("li",Wo,[(0,a.createElementVNode)("a",{class:(0,a.normalizeClass)(["nav-link","edit"===l.activeEditorTabName?"active":""]),onClick:t[2]||(t[2]=(0,a.withModifiers)((e=>l.activeEditorTabName="edit"),["prevent"])),href:"#"},"Редактировать",2)]),(0,a.createElementVNode)("li",Zo,[(0,a.createElementVNode)("a",{class:(0,a.normalizeClass)(["nav-link","preview"===l.activeEditorTabName?"active":""]),onClick:t[3]||(t[3]=(0,a.withModifiers)((e=>l.activeEditorTabName="preview"),["prevent"])),href:"#"},"Предпросмотр",2)])])):(0,a.createCommentVNode)("",!0),l.isEditing?((0,a.openBlock)(),(0,a.createElementBlock)("div",Qo,["edit"===l.activeEditorTabName?(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createElementBlock)("textarea",{key:0,class:"form-control","onUpdate:modelValue":t[4]||(t[4]=e=>l.modifiedBody=e),rows:n.textAreaRowsQty},"\n      ",8,Xo)),[[a.vModelText,l.modifiedBody]]):(0,a.createCommentVNode)("",!0),"preview"===l.activeEditorTabName?((0,a.openBlock)(),(0,a.createElementBlock)("div",Ko,[(0,a.createElementVNode)("span",{innerHTML:n.markdownToHtml(this.modifiedBody)},null,8,Go)])):(0,a.createCommentVNode)("",!0),Yo,(0,a.createElementVNode)("div",ea,[(0,a.createElementVNode)("button",{class:"btn btn-sm btn-secondary me-1",onClick:t[5]||(t[5]=e=>l.isEditing=!1)},[ta,(0,a.createTextVNode)(" Отмена ")]),(0,a.createElementVNode)("button",{class:"btn btn-sm btn-success",onClick:t[6]||(t[6]=(...e)=>n.onClickSave&&n.onClickSave(...e))},[oa,(0,a.createTextVNode)(" Сохранить ")])])])):(0,a.createCommentVNode)("",!0),l.isEditing?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:2,class:"card-body",id:"comment-body-"+o.comment.id},[(0,a.createElementVNode)("span",{innerHTML:n.markdownToHtml(o.comment.body)},null,8,sa)],8,aa))],2)}var na={name:"CommentCard",props:{comment:Object,userInfo:Object},data(){return{isEditing:!1,activeEditorTabName:"edit",modifiedBody:null}},computed:{textAreaRowsQty(){const e=3,t=ot(this.modifiedBody);return t<=e?e:t}},methods:{useFormatDateTime:Ye,useAuthorShortName:tt,useLinesCount:ot,onClickEdit(){this.isEditing=!0,this.activeEditorTabName="edit",this.modifiedBody=this.comment.body},onClickSave(){alert("В РАЗРАБОТКЕ!\nЗдесь редактирование пока не работает - воспользуйтесь кнопкой редактирования комментария на отдельной странице задачи.\n\nEdit comment "+this.comment.id)},onClickArchive(){alert("В РАЗРАБОТКЕ!\nЗдесь удаление пока не работает - воспользуйтесь кнопкой удаления комментария на отдельной странице задачи.\n\nArchive comment "+this.comment.id)},markdownToHtml(e){return this.markdown(e)},sanitize(e){return this.sanitizeHtml(e)}}};const ia=(0,Le.Z)(na,[["render",la],["__scopeId","data-v-2ce3f3ca"]]);var ca=ia,ra={name:"CommentTimelineItem",components:{CommentCard:ca},props:{comment:Object,userInfo:Object},methods:{useFormatDateTime:Ye,useAuthorAvatarURL:et,useAuthorShortName:tt}};const da=(0,Le.Z)(ra,[["render",Mo]]);var ma=da;const ka={class:"mb-3"},ua=(0,a.createElementVNode)("label",{for:"comment_text",class:"form-label"},"Добавить комментарий:",-1),pa={class:"d-flex"},ha={class:"me-2"},fa=["src","alt"],ba={class:"flex-grow-1"},va=["rows","disabled"],Na={class:"d-flex mb-3 flex-wrap"},ga={class:"flex-grow-1"},Va=["disabled"],wa=(0,a.createElementVNode)("label",{class:"form-check-label",for:"check-complete-task"}," Завершить задачу с этим комментарием ",-1),Ea={class:"btn-toolbar mb-2 mb-md-0 justify-content-end"},Ca=["disabled"],ya=(0,a.createElementVNode)("i",{class:"fa-solid fa-file-signature"},null,-1),Ta=["disabled"],xa=(0,a.createElementVNode)("i",{class:"fa-solid fa-file-circle-check"},null,-1),Ba=(0,a.createElementVNode)("i",{class:"fa-solid fa-comment"},null,-1),Sa={key:0,class:"alert alert-secondary flex-grow-1 m-1"},_a=(0,a.createElementVNode)("h5",null,"Предварительный просмотр",-1),Ia={class:"card-body"},Oa=["innerHTML"];function Aa(e,t,o,s,l,n){return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[(0,a.createElementVNode)("form",null,[(0,a.createElementVNode)("div",ka,[ua,(0,a.createElementVNode)("div",pa,[(0,a.createElementVNode)("div",ha,[o.userInfo.avatar_img?((0,a.openBlock)(),(0,a.createElementBlock)("img",{key:0,class:"rounded-circle",src:o.userInfo.avatar_img,alt:"Фото "+o.userInfo.username,width:"48",height:"48"},null,8,fa)):(0,a.createCommentVNode)("",!0)]),(0,a.createElementVNode)("div",ba,[(0,a.withDirectives)((0,a.createElementVNode)("textarea",{class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>l.newCommentText=e),rows:n.textAreaRowsQty,disabled:l.isPosting},null,8,va),[[a.vModelText,l.newCommentText]])])])]),(0,a.createElementVNode)("div",Na,[(0,a.createElementVNode)("div",ga,[(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.isCompleteTask=e),class:"form-check-input me-1",type:"checkbox",id:"check-complete-task",disabled:n.isCompleteTaskCheckboxDisabled},null,8,Va),[[a.vModelCheckbox,l.isCompleteTask]]),wa]),(0,a.createElementVNode)("div",Ea,[o.task.is_acquainted?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createElementBlock)("button",{key:0,onClick:t[2]||(t[2]=(0,a.withModifiers)(((...e)=>o.onClickAcquaint&&o.onClickAcquaint(...e)),["prevent"])),disabled:l.isAcquainting,class:"btn btn-sm btn-primary me-2"},[ya,(0,a.createTextVNode)(" Ознакомлен ")],8,Ca)),(0,a.createElementVNode)("button",{onClick:t[3]||(t[3]=(0,a.withModifiers)(((...e)=>n.onClickSubmit&&n.onClickSubmit(...e)),["prevent"])),disabled:l.isPosting,class:"btn btn-sm btn-success"},[l.isCompleteTask?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[xa,(0,a.createTextVNode)(" Завершить задачу ")],64)):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[Ba,(0,a.createTextVNode)(" Комментировать ")],64))],8,Ta)])])]),n.isPreviewVisible?((0,a.openBlock)(),(0,a.createElementBlock)("div",Sa,[_a,(0,a.createElementVNode)("div",Ia,[(0,a.createElementVNode)("span",{innerHTML:n.markdownToHtml},null,8,Oa)])])):(0,a.createCommentVNode)("",!0)],64)}var Fa={name:"NewCommentEditor",props:["task","onClickAcquaint","userInfo"],emits:["newCommentPosted"],data(){return{newCommentText:"",isCompleteTask:!1,isPosting:!1,isAcquainting:!1}},methods:{useLinesCount:ot,onClickSubmit(){if(!(this.newCommentText.trimStart().trimEnd().length<5)){this.isPosting=!0;const e={task:this.task.id,author:this.userInfo.id,body:this.newCommentText};return window.axios.post("/journal/tasks/api/v1/comment/",{newComment:e,isCompleteTask:this.isCompleteTask}).then((e=>{this.isPosting=!1,this.newCommentText="",this.$emit("newCommentPosted",e)})).catch((function(e){console.log(e)}))}alert("Для отправки комментария, введите текст (не менее 5 символов)!")}},computed:{markdownToHtml(){return this.markdown(this.newCommentText)},isPreviewVisible(){return this.newCommentText.trimStart().trimEnd().length>0},textAreaRowsQty(){const e=3,t=ot(this.newCommentText);return t<=e?e:t},isCompleteTaskCheckboxDisabled(){return this.newCommentText.trimStart().trimEnd().length<5||this.isPosting}}};const Da=(0,Le.Z)(Fa,[["render",Aa]]);var Ma=Da,ja={name:"TaskListSidebar",components:{OptionsPanel:$e,TaskCard:go,TaskFavoriteButton:Ge,TimeLine:xo,CommentTimelineItem:ma,NewCommentEditor:Ma},props:{userInfo:Object,tasks:Array,filteredTasks:Array,categories:Array,latestNotification:Object,isWebSocketConnected:Boolean},emits:["favoriteToggled","acquainted","newCommentPosted"],data(){return{viewOptions:He,selectedItem:null,detailItem:null,comments:null}},computed:{newTasksCount(){return this.tasks.filter((e=>!e.is_acquainted)).length},favoriteTasksCount(){return this.tasks.filter((e=>e.is_favorite)).length},activeTasksCount(){return this.tasks.filter((e=>!e.is_completed)).length}},methods:{useFormatDateTime:Ye,useAuthorAvatarURL:et,useAuthorShortName:tt,isTaskListItemActive(e){return this.selectedItem&&this.selectedItem.id===e.id},isTaskListItemBgSuccessClass(e){return!this.isTaskListItemActive(e)&&!e.is_acquainted},markdownToHtml(e){return this.markdown(e)},sanitize(e){return this.sanitizeHtml(e)},fetchSelectedTask(){const e=`/journal/tasks/api/v1/task/${this.selectedItem.id}/`;return window.axios.get(e,{}).then((e=>(this.detailItem=e.data,e.data))).catch((function(e){throw console.log("Axios.get error:",e),e}))},fetchSelectedTaskComments(){const e="/journal/tasks/api/v1/comment_list/";return window.axios.get(e,{params:{taskId:this.selectedItem.id}}).then((e=>(this.comments=e.data,e.data))).catch((function(e){throw console.log("Axios.get error:",e),e}))},onClickAcquaint(){const e=`/journal/tasks/api/v1/task/${this.detailItem.id}/acquaint/`;return this.isAcquainting=!0,window.axios.get(e,{params:{}}).then((e=>{this.$emit("acquainted",e),this.isAcquainting=!1,this.fetchSelectedTask(),this.fetchSelectedTaskComments()})).catch((function(e){throw console.log("Axios.get error:",e),e}))},onNewCommentPosted(){this.$emit("newCommentPosted"),this.fetchSelectedTask(),this.fetchSelectedTaskComments()}},watch:{selectedItem:{handler(){this.fetchSelectedTask(),this.fetchSelectedTaskComments()},deep:!0},latestNotification:{handler(){if(this.selectedItem)switch(this.latestNotification.verb_code){case"comment_add":this.latestNotification.target_obj_id===this.selectedItem.id&&(this.fetchSelectedTaskComments(),this.fetchSelectedTask());break;case"comment_edit":this.fetchSelectedTaskComments();break;case"task_edit":case"task_completed":this.latestNotification.target_obj_id===this.selectedItem.id&&this.fetchSelectedTask();break}},deep:!0}},mounted(){this.selectedItem||this.filteredTasks.length&&(this.selectedItem=this.filteredTasks[0])}};const La=(0,Le.Z)(ja,[["render",qt],["__scopeId","data-v-959d1fe8"]]);var qa=La,Pa={name:"App",components:{TaskListTable:lt,TaskListSidebar:qa},data(){return{fetchOptions:Me,taskFilters:Ue,viewOptions:He,tasksAll:[],categoriesAll:[],userInfo:{id:0,username:"",avatar_img:""},webSocket:null,isWebSocketConnected:!1,latestNotification:null}},computed:{filteredTasks(){let e=this.tasksAll;return Ue.showCompleted||(e=e.filter((e=>!e.is_completed))),Ue.showActive||(e=e.filter((e=>e.is_completed))),Ue.showFavoritesOnly&&(e=e.filter((e=>e.is_favorite))),Ue.showPrivate||(e=e.filter((e=>!e.is_private))),e=e.filter((e=>He.categoriesVisibleIds.includes(e.category))),e}},watch:{fetchOptions:{handler(e){localStorage.setItem("fetchOptions",JSON.stringify(e)),this.fetchAllTasks()},deep:!0},viewOptions:{handler(e){localStorage.setItem("viewOptions",JSON.stringify(e))},deep:!0},taskFilters:{handler(e){localStorage.setItem("taskFilters",JSON.stringify(e))},deep:!0}},methods:{webSocketConnect(){const e="ws://"+window.location.host+"/ws/notifications/";this.webSocket=new WebSocket(e),this.webSocket.onopen=()=>{console.log("Vue: WebSocket opened."),this.isWebSocketConnected=!0},this.webSocket.onmessage=e=>{switch(this.latestNotification=JSON.parse(e.data),console.log("Vue  - WS message - verb: "+this.latestNotification.verb_code+" from "+this.latestNotification.actor.username),this.latestNotification.verb_code){case"task_add":case"task_edit":case"task_completed":case"comment_add":this.fetchAllTasks()}},this.webSocket.onclose=e=>{console.log("Vue: Socket is closed unexpectedly. Reconnect will be attempted in 1 second. Error message: ",e.message),this.isWebSocketConnected=!1,setTimeout((()=>{this.webSocketConnect()}),1e3)},this.webSocket.onerror=e=>{console.error("Vue: Socket encountered error: ",e.message,". Closing socket."),this.isWebSocketConnected=!1,this.webSocket.close()}},fetchAllCategories(){const e=window.location.origin+"/journal/tasks/api/v1/category_list/";return window.axios.get(e,{params:{}}).then((e=>{this.categoriesAll=e.data;let t=JSON.parse(localStorage.getItem("viewOptions"));return t&&He.set(t),null===He.categoriesVisibleIds&&He.copyAllCategoryIdsToVisible(this.categoriesAll),e.data})).catch((function(e){throw console.log("Axios.get error:",e),e}))},fetchAllTasks(){const e=window.location.origin+"/journal/tasks/api/v1/task_list/";let t={orderByFields:Me.orderByFields.toString()};return window.axios.get(e,{params:t}).then((e=>(this.tasksAll=e.data,e.data))).catch((function(e){throw console.log("Axios.get error:",e),e}))},fetchUserInfo(){const e="/users/api/v1/logged_in_user/";return window.axios.get(e,{params:{}}).then((e=>{this.userInfo=e.data})).catch((function(e){throw console.log("Axios.get error:",e),e}))}},created(){this.fetchAllCategories(),this.fetchUserInfo(),this.webSocketConnect()},mounted(){let e=JSON.parse(localStorage.getItem("fetchOptions"));e&&Me.set(e);let t=JSON.parse(localStorage.getItem("taskFilters"));t&&Ue.set(t),this.fetchAllTasks()}};const Ua=(0,Le.Z)(Pa,[["render",h]]);var Ha=Ua,za=o(855),Ra=o(5068),$a=o(3617);window.axios=o(7218),window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";let Ja=document.getElementsByName("csrfmiddlewaretoken");Ja?window.axios.defaults.headers.common["X-CSRFToken"]=Ja[0].value:console.error("CSRF token not found: https://docs.djangoproject.com/en/3.0/ref/csrf/#ajax"),Ra.TU.setOptions({breaks:!0});const Wa={methods:{markdown:function(e){return $a.sanitize((0,Ra.TU)(e))},sanitizeHtml:function(e){return $a.sanitize(e)}}},Za=(0,a.createApp)(Ha);za.S({app:Za,dsn:"https://f34f0f582dfa429e868907665de40a62@o1402378.ingest.sentry.io/4504825355698176",tracesSampleRate:.1}),Za.mixin(Wa),Za.mount("#dashboard-page-content")}},t={};function o(a){var s=t[a];if(void 0!==s)return s.exports;var l=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(l.exports,l,l.exports,o),l.loaded=!0,l.exports}o.m=e,function(){var e=[];o.O=function(t,a,s,l){if(!a){var n=1/0;for(d=0;d<e.length;d++){a=e[d][0],s=e[d][1],l=e[d][2];for(var i=!0,c=0;c<a.length;c++)(!1&l||n>=l)&&Object.keys(o.O).every((function(e){return o.O[e](a[c])}))?a.splice(c--,1):(i=!1,l<n&&(n=l));if(i){e.splice(d--,1);var r=s();void 0!==r&&(t=r)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[a,s,l]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.hmd=function(e){return e=Object.create(e),e.children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e}}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,l,n=a[0],i=a[1],c=a[2],r=0;if(n.some((function(t){return 0!==e[t]}))){for(s in i)o.o(i,s)&&(o.m[s]=i[s]);if(c)var d=c(o)}for(t&&t(a);r<n.length;r++)l=n[r],o.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return o.O(d)},a=self["webpackChunkvue_tasks_table_view"]=self["webpackChunkvue_tasks_table_view"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=o.O(void 0,[998],(function(){return o(6199)}));a=o.O(a)})();
//# sourceMappingURL=app.js.map